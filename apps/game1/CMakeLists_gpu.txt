cmake_minimum_required(VERSION 3.0 FATAL_ERROR)
project(example)

set(CMAKE_CUDA_FLAGS "${CMAKE_CUDA_FLAGS} --compiler-bindir=\"/usr/bin/gcc-9\"  --libdevice-directory=\"/usr/lib/nvidia-cuda-toolkit/libdevice\" --dont-use-profile" )
set(CMAKE_CUDA_COMPILER "/usr/lib/nvidia-cuda-toolkit/bin/nvcc")

set(
        xtl_DIR
        /data/home/debraj1/xtl/build
        CACHE STRING "" FORCE
)
set(
        xtensor_DIR
        /data/home/debraj1/xtensor/build
        CACHE STRING "" FORCE
)
set(
        xsimd_DIR
        /data/home/debraj1/xsimd/build
        CACHE STRING "" FORCE
)

set(CMAKE_CUDA_COMPILER_FORCED "true")
set(CUDNN_INCLUDE_PATH "/data/home/debraj1/cudnn/cudnn-linux-x86_64-8.4.1.50_cuda11.6-archive/include")
set(CUDNN_LIBRARY_PATH "/data/home/debraj1/cudnn/cudnn-linux-x86_64-8.4.1.50_cuda11.6-archive/lib/libcudnn.so")

set (CMAKE_CXX_FLAGS "-g ${CMAKE_CXX_FLAGS}")

set(Torch_DIR "/data/home/debraj1/torch_cuda_10_2/libtorch/share/cmake/Torch")

find_package(PythonInterp REQUIRED)
find_package(CUDA REQUIRED)
enable_language(CUDA)
find_package(Torch REQUIRED)

set(CMAKE_OSX_ARCHITECTURES "x86_64")

find_package(xsimd REQUIRED PATHS /data/home/debraj1/xsimd/build)
find_package(xtensor REQUIRED PATHS /data/home/debraj1/xtensor/build)
find_package(jsoncpp REQUIRED PATHS /data/home/debraj1/jsoncpp/build)

include_directories("./")

add_definitions(-DXTENSOR_ENABLE_XSIMD)

add_executable(example test.cpp)

target_include_directories(example PUBLIC ${xtensor_INCLUDE_DIRS})
target_link_libraries(example "${TORCH_LIBRARIES}" "${CUDA_LIBRARIES}" xtensor ${JSONCPP_LIBRARIES})

set_property(TARGET example PROPERTY CXX_STANDARD 14)
